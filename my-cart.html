<!DOCTYPE html>
<html lang="en">
<head>
    <title>My cart</title>
    <link rel="stylesheet" type="text/css" href="/src/e-order.css">
    <link rel="icon" type="image/png" href="/images/my-cart.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <h1 class="gradient-text">My Cart</h1>
    <button id="clear-cart-button" onclick="clearCart()">
        Clear My Cart
    </button>
    <button id="return-to-main" onclick="redirectToMainPage()">Back to Home</button>
    <ul id="cart-items"></ul>

    <div id="downloadPopup">
        <i class="fas fa-check"></i>
        <p>Your order is ready!</p>
    </div>

    <button id="generateExcelBtn" onclick="convertCartListToExcel()">Generate Excel</button>

    <script src="/src/e-order.js"></script>
    <script>
        function displayCartItems() {
            const cartItemsList = document.getElementById('cart-items');
            cartItemsList.innerHTML = '';   // Clearing existing cart items

            let listItemFormat = '';
            let ItemCounter = 0;

            cartItems.forEach(item => {
                // const listItem = document.createElement('li');
                // const itemText = document.createElement('h4');
                // itemText.textContent = `${item.name} | Quantity: ${item.quantity}`;
                // listItem.appendChild(itemText);
                // cartItemsList.appendChild(listItem);
                if(ItemCounter % 4 === 0) {
                    listItemFormat += '<br>';
                }
                listItemFormat += `<li>${item.name} | Quantity: ${item.quantity}</li>`;
                ItemCounter++;
            });

            cartItemsList.innerHTML = listItemFormat;
        }
        
        //Converting Cart List into excel file
        function convertCartListToExcel() {
            const currentDate = new Date();
            const day = String(currentDate.getDate()).padStart(2, '0');
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const year = currentDate.getFullYear();
            const fileName = `Order_${day}-${month}-${year}.csv`;

            const csvContent = `Product,Quantity\n` + cartItems.map(item => `${item.name},${item.quantity}`).join('\n');
            const excelContent = `data:text/csv;charset=utf-8,\uFEFF${encodeURIComponent(csvContent)}`;

            const downloadLink = createDownloadLink(excelContent, fileName);
            downloadLink.style.display = 'none';
            document.body.appendChild(downloadLink);

            downloadLink.click();

            // Show download popup
            const downloadPopup = document.getElementById('downloadPopup');
            downloadPopup.style.display = 'flex';
            setTimeout(() => {
                downloadPopup.style.display = 'none';
            }, 6000);
        }

        //Creating download link
        function createDownloadLink(content, filename) {
            const downloadLink = document.createElement('a');
            downloadLink.href = content;
            downloadLink.download = filename;
            return downloadLink;
        }

        // Calling displayCartItems() when the my-cart.html loads
        window.addEventListener('DOMContentLoaded', displayCartItems);
    </script>

    <footer>
        <p>&copy; 2023 E-Paraggeliamou Application</p>
    </footer>
</body>
</html>
